alias: Boiler - OFF Logic (Smart Hybrid)
description: "×× ×”×œ ×›×™×‘×•×™ ×—×›×: ××‘×“×™×œ ×‘×™×Ÿ ×–××Ÿ ×¡× ×¡×•×¨ (×œ××•×˜×•××˜×™) ×œ×–××Ÿ ×§×‘×•×¢ (×œ×™×“× ×™)"
triggers:
  - trigger: state
    entity_id: switch.boiler
    to: "on"
    for:
      minutes: "{{ states('sensor.boiler_time') | int(30) }}"
    id: Auto_Time_Limit
  - trigger: state
    entity_id:
      - switch.boiler
    to:
      - "on"
    for:
      hours: 1
      minutes: 30
      seconds: 0
    id: Manual_Safety_Time
  - trigger: time
    at: "18:32:00"
    id: Absolute_Time
  - trigger: numeric_state
    entity_id: sensor.boiler_temp_temperature
    above: 60
    id: Overheat
conditions: []
actions:
  - choose:
      - conditions:
          - condition: trigger
            id: Auto_Time_Limit
          - condition: state
            entity_id: input_boolean.boiler_auto_mode
            state: "on"
        sequence:
          - action: switch.turn_off
            target:
              entity_id: switch.boiler
          - action: notify.greenapi
            data:
              message: ğŸ“¢ ×›×™×‘×™×ª×™ ××ª ×”×“×•×“ (× ×’××¨ ×”×–××Ÿ ×”××•×˜×•××˜×™).
              target: 12345678@g.us
          - data:
              title: ×“×•×“ ××™× ×—×›×
              message: ğŸ“¢ ×›×™×‘×™×ª×™ ××ª ×”×“×•×“
              target: -12345678
            action: telegram_bot.send_message
      - conditions:
          - condition: trigger
            id: Manual_Safety_Time
          - condition: state
            entity_id: input_boolean.boiler_auto_mode
            state: "off"
        sequence:
          - action: switch.turn_off
            target:
              entity_id: switch.boiler
          - action: notify.greenapi
            data:
              message: ğŸ›¡ï¸ ×›×™×‘×™×ª×™ ××ª ×”×“×•×“ (×¢×‘×¨×” ×©×¢×” ×•×—×¦×™ ×©×œ ×”×¤×¢×œ×” ×™×“× ×™×ª).
              target: 12345678@g.us
          - data:
              title: ×“×•×“ ××™× ×—×›×
              message: ğŸ“¢  ×›×™×‘×™×ª×™ ××ª ×”×“×•×“ ×¢×‘×¨×” ×©×¢×” ×•×—×¦×™ ×©×œ ×¤×¢×•×œ×”
              target: -1234568
            action: telegram_bot.send_message
      - conditions:
          - condition: or
            conditions:
              - condition: trigger
                id: Absolute_Time
              - condition: trigger
                id: Overheat
        sequence:
          - action: switch.turn_off
            target:
              entity_id: switch.boiler
          - action: notify.greenapi
            data:
              message: âš ï¸ ×›×™×‘×™×ª×™ ×‘×—×™×¨×•× (×©×¢×” 18:32 ××• ×—×•× ×™×ª×¨).
              target: 12345678@g.us
mode: single
